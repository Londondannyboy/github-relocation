---
import Layout from '../../layouts/Layout.astro';
import { sanityClient } from '../../lib/sanity';

// Fetch posts by country
const posts = await sanityClient.fetch(`
  *[_type == "post"] {
    _id,
    title,
    slug,
    excerpt,
    focusKeyword,
    searchVolume,
    cpc
  }
`);

// Group posts by country
const countryData = {
  cyprus: {
    name: 'Cyprus',
    flag: 'ğŸ‡¨ğŸ‡¾',
    description: 'EU member, non-dom tax status, golden visa program',
    highlights: ['17 years non-dom benefits', 'â‚¬300K golden visa', 'English widely spoken'],
    posts: posts.filter(p => p.title?.toLowerCase().includes('cyprus'))
  },
  malta: {
    name: 'Malta',
    flag: 'ğŸ‡²ğŸ‡¹',
    description: 'EU member, remittance-based taxation, gaming hub',
    highlights: ['EU passport', 'English official language', 'Gaming industry hub'],
    posts: posts.filter(p => p.title?.toLowerCase().includes('malta'))
  },
  dubai: {
    name: 'Dubai/UAE',
    flag: 'ğŸ‡¦ğŸ‡ª',
    description: 'Tax-free income, business hub, golden visa options',
    highlights: ['0% income tax', 'World-class infrastructure', '10-year golden visa'],
    posts: posts.filter(p => p.title?.toLowerCase().includes('dubai') || p.title?.toLowerCase().includes('uae'))
  },
  portugal: {
    name: 'Portugal',
    flag: 'ğŸ‡µğŸ‡¹',
    description: 'NHR regime, D7 visa, path to EU citizenship',
    highlights: ['10-year NHR benefits', 'D7 passive income visa', 'Affordable living'],
    posts: posts.filter(p => p.title?.toLowerCase().includes('portugal'))
  },
  singapore: {
    name: 'Singapore',
    flag: 'ğŸ‡¸ğŸ‡¬',
    description: 'Asia hub, territorial taxation, PR pathways',
    highlights: ['Territorial tax system', 'Business-friendly', 'World-class education'],
    posts: posts.filter(p => p.title?.toLowerCase().includes('singapore'))
  }
};

const countries = Object.entries(countryData);
---

<Layout title="Countries Guide | Relocation Destinations | Relocation Quest">
  <main class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-100">
    <div class="container mx-auto px-4 py-16">
      <!-- Breadcrumbs -->
      <nav class="text-sm mb-6">
        <a href="/" class="text-blue-600 hover:underline">Home</a>
        <span class="mx-2">/</span>
        <span class="text-gray-600">Countries</span>
      </nav>

      <!-- Hero Section -->
      <div class="bg-white rounded-lg shadow-lg p-8 mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-purple-900 mb-4">
          Top Relocation Destinations
        </h1>
        <p class="text-xl text-gray-700 mb-6">
          Comprehensive guides for the world's best relocation destinations
        </p>
        
        <!-- Quick Compare -->
        <div class="overflow-x-auto">
          <table class="min-w-full mt-8">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-2 text-left">Country</th>
                <th class="px-4 py-2 text-left">Tax Benefits</th>
                <th class="px-4 py-2 text-left">Visa Options</th>
                <th class="px-4 py-2 text-left">Min. Investment</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <td class="px-4 py-3">ğŸ‡¨ğŸ‡¾ Cyprus</td>
                <td class="px-4 py-3">Non-dom 17 years</td>
                <td class="px-4 py-3">Golden Visa, PR</td>
                <td class="px-4 py-3">â‚¬300,000</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-3">ğŸ‡²ğŸ‡¹ Malta</td>
                <td class="px-4 py-3">Remittance basis</td>
                <td class="px-4 py-3">Global Residence</td>
                <td class="px-4 py-3">â‚¬600,000</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-3">ğŸ‡¦ğŸ‡ª Dubai</td>
                <td class="px-4 py-3">0% income tax</td>
                <td class="px-4 py-3">Golden Visa</td>
                <td class="px-4 py-3">AED 2M</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-3">ğŸ‡µğŸ‡¹ Portugal</td>
                <td class="px-4 py-3">NHR 10 years</td>
                <td class="px-4 py-3">D7, Golden Visa</td>
                <td class="px-4 py-3">â‚¬500,000</td>
              </tr>
              <tr class="border-b">
                <td class="px-4 py-3">ğŸ‡¸ğŸ‡¬ Singapore</td>
                <td class="px-4 py-3">Territorial</td>
                <td class="px-4 py-3">Employment Pass</td>
                <td class="px-4 py-3">SGD 2.5M</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Countries Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {countries.map(([key, country]) => (
          <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white">
              <div class="text-4xl mb-2">{country.flag}</div>
              <h2 class="text-2xl font-bold">{country.name}</h2>
              <p class="text-purple-100 text-sm mt-1">{country.description}</p>
            </div>
            
            <div class="p-6">
              <h3 class="font-semibold mb-3">Key Benefits</h3>
              <ul class="space-y-2 mb-4">
                {country.highlights.map(highlight => (
                  <li class="flex items-start">
                    <span class="text-green-500 mr-2">âœ“</span>
                    <span class="text-sm text-gray-700">{highlight}</span>
                  </li>
                ))}
              </ul>
              
              {country.posts.length > 0 && (
                <div class="border-t pt-4">
                  <h4 class="font-semibold text-sm mb-2">Popular Guides</h4>
                  <ul class="space-y-1">
                    {country.posts.slice(0, 3).map(post => (
                      <li>
                        <a href={`/posts/${post.slug.current}`} 
                           class="text-sm text-blue-600 hover:underline">
                          {post.title}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
              
              <a href={`/countries/${key}`} 
                 class="mt-4 inline-block text-purple-600 font-semibold hover:text-purple-800">
                View All {country.name} Guides â†’
              </a>
            </div>
          </div>
        ))}
      </div>

      <!-- Additional Countries -->
      <section class="mt-12">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">More Destinations</h2>
        <div class="bg-white rounded-lg shadow p-6">
          <div class="grid md:grid-cols-3 gap-6">
            <div>
              <h3 class="font-semibold mb-3">Caribbean</h3>
              <ul class="space-y-2 text-sm">
                <li><a href="/countries/st-kitts" class="text-blue-600 hover:underline">ğŸ‡°ğŸ‡³ St. Kitts & Nevis</a></li>
                <li><a href="/countries/antigua" class="text-blue-600 hover:underline">ğŸ‡¦ğŸ‡¬ Antigua & Barbuda</a></li>
                <li><a href="/countries/grenada" class="text-blue-600 hover:underline">ğŸ‡¬ğŸ‡© Grenada</a></li>
                <li><a href="/countries/dominica" class="text-blue-600 hover:underline">ğŸ‡©ğŸ‡² Dominica</a></li>
              </ul>
            </div>
            
            <div>
              <h3 class="font-semibold mb-3">Europe</h3>
              <ul class="space-y-2 text-sm">
                <li><a href="/countries/greece" class="text-blue-600 hover:underline">ğŸ‡¬ğŸ‡· Greece</a></li>
                <li><a href="/countries/spain" class="text-blue-600 hover:underline">ğŸ‡ªğŸ‡¸ Spain</a></li>
                <li><a href="/countries/italy" class="text-blue-600 hover:underline">ğŸ‡®ğŸ‡¹ Italy</a></li>
                <li><a href="/countries/ireland" class="text-blue-600 hover:underline">ğŸ‡®ğŸ‡ª Ireland</a></li>
              </ul>
            </div>
            
            <div>
              <h3 class="font-semibold mb-3">Asia Pacific</h3>
              <ul class="space-y-2 text-sm">
                <li><a href="/countries/malaysia" class="text-blue-600 hover:underline">ğŸ‡²ğŸ‡¾ Malaysia</a></li>
                <li><a href="/countries/thailand" class="text-blue-600 hover:underline">ğŸ‡¹ğŸ‡­ Thailand</a></li>
                <li><a href="/countries/philippines" class="text-blue-600 hover:underline">ğŸ‡µğŸ‡­ Philippines</a></li>
                <li><a href="/countries/japan" class="text-blue-600 hover:underline">ğŸ‡¯ğŸ‡µ Japan</a></li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Interactive Map Placeholder -->
      <section class="mt-12">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Explore by Map</h2>
        <div class="bg-white rounded-lg shadow p-8">
          <div class="bg-gray-100 rounded-lg h-96 flex items-center justify-center">
            <div class="text-center">
              <p class="text-gray-600 mb-4">ğŸ—ºï¸</p>
              <p class="text-xl font-semibold text-gray-700">Interactive World Map</p>
              <p class="text-gray-500 mt-2">Coming Soon - Click any country to explore relocation options</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>
</Layout>